<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>Matching</ion-title>
  </ion-toolbar>
</ion-header>
<ion-content>
  <swiper
    [slidesPerView]="1"
    [pagination]="true"
    [initialSlide]="0"
    [allowSlideNext]="false"
    (swiper)="setSwiperInstance($event)"
  >
    <ng-template swiperSlide>
      <div class="slide-container vertical-center">
        <h2 class="slide-title">
          What is the size of the groups you want to form?
        </h2>
        <form [formGroup]="matchingForm" (submit)="nextSlide()">
          <ion-item class="ion-text-center matching-size-item">
            <ion-input
              class="matching-size-input"
              id="matching-size"
              formControlName="matchingSize"
              type="number"
              [autofocus]="true"
              clearInput
            ></ion-input>
            <ion-label
              for="matching-size"
              aria-label="&nbsp;users per group"
            ></ion-label>
            <ion-label
              *ngIf="!form.matchingSize.valid &&
              form.matchingSize.dirty"
              class="validator-error ion-text-wrap"
            >
              <p>You must have at least 2 people per group</p>
            </ion-label>
          </ion-item>
          <ion-button
            class="ion-margin-top"
            type="submit"
            color="primary"
            fill="clear"
            [disabled]="!matchingForm.valid"
            >Next<ion-icon slot="end" name="arrow-forward-outline"></ion-icon
          ></ion-button>
        </form>
      </div>
    </ng-template>
    <ng-template swiperSlide>
      <div class="slide-container">
        <h2 class="slide-title">
          Select the users to match<br />(at least {{form.matchingSize.value}})
        </h2>
        <ion-button
          class="ion-margin-top"
          color="primary"
          fill="clear"
          (click)="nextSlide()"
          [disabled]="totalSelected < 2"
          >Next<ion-icon slot="end" name="arrow-forward-outline"></ion-icon
        ></ion-button>
        <ion-item>
          <ion-label>Select All</ion-label>
          <ion-checkbox
            slot="start"
            [(ngModel)]="masterCheck"
            [indeterminate]="isIndeterminate"
            (click)="checkMaster()"
          ></ion-checkbox>
        </ion-item>

        <ion-item
          *ngFor="let user of users; let i=index"
          class="ion-padding-xs"
        >
          <ion-checkbox
            [(ngModel)]="user.isChecked"
            (click)="checkEvent($event,user)"
            color="primary"
            slot="start"
          ></ion-checkbox>
          <ion-avatar slot="start">
            <div [innerHTML]="user.avatar"></div>
          </ion-avatar>
          <div class="user-tags">
            <ion-label class="no-overflow"> {{user.name}} </ion-label>
            <div>
              <ion-chip
                *ngFor="let tag of user.groups"
                [color]="ColorsTags[i%2]"
                >{{tag}}
              </ion-chip>
            </div>
          </div>
        </ion-item>
      </div>
    </ng-template>
    <ng-template swiperSlide>
      <div class="slide-container">
        <h2 class="slide-title">
          Are there any users you prefer or do not want to match (optional)?
        </h2>
        <ion-button
          class="ion-margin-top match-btn"
          color="primary"
          (click)="randommatch()"
          [disabled]="usersSelected.length < 2"
        >
          Match
          <ion-icon name="checkmark-done-outline" slot="end"></ion-icon>
        </ion-button>
        <ion-grid>
          <ion-row class="ion-justify-content-center">
            <ion-col>
              <ion-button (click)="forbid()" color="danger" fill="clear">
                Forbid
                <ion-icon slot="end" name="thumbs-down-outline"></ion-icon>
              </ion-button>
              <ion-button (click)="prefer()" color="success" fill="clear">
                Prefer
                <ion-icon slot="end" name="thumbs-up-outline"></ion-icon>
              </ion-button>
            </ion-col>
          </ion-row>

          <ion-row>
            <ion-col size="12" size-md="6" class="vhheight">
              <ion-item
                *ngFor="let user of usersSelected; let i=index"
                class="ion-padding-xs"
              >
                <ion-checkbox
                  [(ngModel)]="user.isChecked"
                  (click)="selectToRestrict($event,user)"
                  color="primary"
                  slot="start"
                ></ion-checkbox>
                <ion-avatar slot="start">
                  <div [innerHTML]="user.avatar"></div>
                </ion-avatar>
                <div class="user-tags">
                  <ion-label class="no-overflow"> {{user.name}} </ion-label>
                  <div class="tags">
                    <ion-chip
                      *ngFor="let tag of user.groups"
                      [color]="ColorsTags[i%2]"
                      >{{tag}}
                    </ion-chip>
                  </div>
                </div>
              </ion-item>
            </ion-col>
            <ion-col size="12" size-md="6">
              <ion-grid>
                <ion-row class="border-bottom halfvh">
                  <ion-col>
                    <h3>Forbidden connections</h3>
                    <ion-list *ngIf="forbiddenConnections.length">
                      <ion-item-group
                        *ngFor="let forbiddenConnection of forbiddenConnections; let i=index"
                      >
                        <ion-item>
                          <ion-grid>
                            <ion-row>
                              <ion-col *ngFor="let user of forbiddenConnection">
                                <ion-label> {{user.name}} </ion-label>
                              </ion-col>
                            </ion-row>
                          </ion-grid>
                          <ion-button
                            fill="clear"
                            color="danger"
                            (click)="removeForbiddenConnection(i)"
                          >
                            <ion-icon name="close-outline"></ion-icon>
                          </ion-button>
                        </ion-item>
                      </ion-item-group>
                    </ion-list>
                  </ion-col>
                </ion-row>
                <ion-row class="halfvh">
                  <ion-col>
                    <h3>Preferred connections</h3>
                    <ion-list *ngIf="preferredConnections.length">
                      <ion-item-group
                        *ngFor="let preferredConnection of preferredConnections; let i=index"
                      >
                        <ion-item>
                          <ion-grid>
                            <ion-row>
                              <ion-col *ngFor="let user of preferredConnection">
                                <ion-label> {{user.name}} </ion-label>
                              </ion-col>
                            </ion-row>
                          </ion-grid>

                          <ion-button
                            fill="clear"
                            color="danger"
                            (click)="removePreferredConnection(i)"
                          >
                            <ion-icon name="close-outline"></ion-icon>
                          </ion-button>
                        </ion-item>
                      </ion-item-group>
                    </ion-list>
                  </ion-col>
                </ion-row>
              </ion-grid>
            </ion-col>
          </ion-row>
        </ion-grid>
      </div>
    </ng-template>
  </swiper>
</ion-content>
